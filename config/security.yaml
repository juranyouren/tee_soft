# TEE_SOFT å®‰å…¨é…ç½® - æ”¹è¿›ç‰ˆå¯†é’¥ç®¡ç†
# æ”¯æŒå¯†é’¥åˆ†ç¦»å’Œæ··åˆåŠ å¯†æ¶æ„

# ğŸ” é€šä¿¡åŠ å¯†é…ç½® (å®¢æˆ·ç«¯-TEE)
communication_encryption:
  # TEEé•¿æœŸå¯†é’¥å¯¹é…ç½®
  tee_keypair:
    algorithm: sm2  # SM2æ¤­åœ†æ›²çº¿å¯†é’¥å¯¹
    curve: sm2p256v1
    key_generation: auto
    private_key_storage: memory_only  # ç§é’¥ä»…å­˜å‚¨åœ¨å†…å­˜ä¸­
    public_key_distribution: embedded_in_client  # å…¬é’¥å†…ç½®åœ¨å®¢æˆ·ç«¯
  
  # ä¼šè¯å¯†é’¥é…ç½®
  session_key:
    algorithm: sm4  # SM4å¯¹ç§°åŠ å¯†
    key_size: 16  # 128ä½
    generation: per_request  # æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–°å¯†é’¥
    lifetime: single_use  # å•æ¬¡ä½¿ç”¨åé”€æ¯
    secure_deletion: immediate  # ç«‹å³å®‰å…¨åˆ é™¤

# ğŸ—„ï¸ æ•°æ®åº“åŠ å¯†é…ç½® (å®Œå…¨ç‹¬ç«‹)
database_encryption:
  # æ•°æ®åº“ç‹¬ç«‹åŠ å¯†
  algorithm: sm4-ecb
  key_size: 16  # 128ä½SM4å¯†é’¥
  hash_algorithm: sm3  # SM3å®Œæ•´æ€§æ ¡éªŒ
  
  # æ•°æ®åº“å¯†é’¥ç®¡ç†
  key_management:
    db_master_key_env: DB_MASTER_KEY  # ç‹¬ç«‹ç¯å¢ƒå˜é‡
    key_derivation: sm3_based  # åŸºäºSM3çš„å¯†é’¥æ´¾ç”Ÿ
    purpose_separation: true  # ä¸åŒç”¨é€”ä½¿ç”¨ä¸åŒå¯†é’¥
    key_rotation_days: 90  # å¯†é’¥è½®æ¢å‘¨æœŸ
    
    # æ”¯æŒçš„å­˜å‚¨ç”¨é€”
    storage_purposes:
      - user_data
      - risk_logs
      - feature_history
      - statistics
  
  # æ•°æ®åº“å®Œæ•´æ€§ä¿æŠ¤
  integrity:
    algorithm: sm3
    verification: mandatory
    failure_action: reject

# ğŸ¯ å¯†é’¥éš”ç¦»ä¿è¯
key_isolation:
  communication_db_separation: true  # é€šä¿¡ä¸æ•°æ®åº“å¯†é’¥å®Œå…¨åˆ†ç¦»
  forward_secrecy: true  # å‰å‘å®‰å…¨æ€§
  backward_secrecy: true  # åå‘å®‰å…¨æ€§
  cross_contamination_prevention: true  # é˜²æ­¢å¯†é’¥äº¤å‰æ±¡æŸ“

# ğŸ“Š æ•°å­—ç­¾åé…ç½®
digital_signature:
  algorithm: sm2
  curve: sm2p256v1
  hash_algorithm: sm3
  signing_context: response_authentication

# ğŸ›¡ï¸ TEEç¯å¢ƒé…ç½®
tee:
  memory_limit: 134217728  # 128MB
  secure_memory: true
  key_material_isolation: true
  
  # å†…å­˜ç›‘æ§é…ç½®
  memory_monitor:
    interval: 5
    alert_threshold: 0.8
    cleanup_threshold: 0.9
    force_cleanup_on_session_end: true
  
  # å®‰å…¨æ¸…ç†é…ç½®
  secure_cleanup:
    session_keys: immediate
    plaintext_features: immediate
    temporary_data: immediate
    method: cryptographic_erasure

# ğŸ”’ åŠ å¯†æ“ä½œé…ç½®
encryption_operations:
  # å®¢æˆ·ç«¯åŠ å¯†æµç¨‹
  client_flow:
    step1: generate_session_key
    step2: encrypt_features_with_session_key
    step3: encrypt_session_key_with_tee_public_key
    step4: send_encrypted_message
  
  # TEEè§£å¯†æµç¨‹
  tee_flow:
    step1: decrypt_session_key_with_tee_private_key
    step2: decrypt_features_with_session_key
    step3: process_features_in_secure_memory
    step4: encrypt_for_database_with_independent_key
    step5: secure_delete_session_data

# âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®
performance:
  session_key_cache: false  # ä¸ç¼“å­˜ä¼šè¯å¯†é’¥
  batch_encryption: true
  hardware_acceleration: true
  parallel_processing: true

# ğŸ“ˆ å®‰å…¨ç›‘æ§é…ç½®
security_monitoring:
  key_usage_audit: true
  encryption_performance_tracking: true
  security_violations_detection: true
  
  # å‘Šè­¦é…ç½®
  alerts:
    key_reuse_detection: error
    unusual_encryption_patterns: warning
    performance_anomalies: info
    integrity_failures: critical

# ğŸ”§ å…¼å®¹æ€§é…ç½®
compatibility:
  # å‘åå…¼å®¹ä¼ ç»ŸåŠ å¯†
  legacy_support:
    aes_256_gcm: true
    ed25519: true
    sha256: true
  
  # å›½å¯†ç®—æ³•ä¼˜å…ˆ
  algorithm_priority:
    - sm4
    - sm2
    - sm3
    - aes-256-gcm  # å¤‡ç”¨
    - ed25519     # å¤‡ç”¨
    - sha256      # å¤‡ç”¨

# ğŸŒ åˆè§„æ€§é…ç½®
compliance:
  national_crypto_standards: true
  standards:
    - "GB/T 32907-2016"  # SM4
    - "GB/T 32905-2016"  # SM3
    - "GB/T 32918-2016"  # SM2
  commercial_crypto_level: true

# ğŸš¨ åº”æ€¥é…ç½®
emergency:
  key_compromise_response:
    immediate_rotation: true
    revoke_all_sessions: true
    audit_log_enhancement: true
  
  system_recovery:
    key_regeneration: automatic
    data_integrity_check: mandatory
    service_restoration: gradual 